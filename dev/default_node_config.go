/*
 *  Copyright 2018 KardiaChain
 *  This file is part of the go-kardia library.
 *
 *  The go-kardia library is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU Lesser General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  The go-kardia library is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 *  GNU Lesser General Public License for more details.
 *
 *  You should have received a copy of the GNU Lesser General Public License
 *  along with the go-kardia library. If not, see <http://www.gnu.org/licenses/>.
 */

// Defines default configs used for initializing nodes in dev settings.

package dev

import (
	"bufio"
	"crypto/ecdsa"
	"encoding/csv"
	"encoding/hex"
	"fmt"
	"io"
	"math"
	"os"
	"strconv"
	"strings"

	"github.com/kardiachain/go-kardia/lib/common"
	"github.com/kardiachain/go-kardia/lib/crypto"
	"github.com/kardiachain/go-kardia/lib/log"
	"github.com/kardiachain/go-kardia/types"
)

const (
	// GenesisAccount used for matchEth tx
	MockKardiaAccountForMatchEthTx = "0x071E8F5ddddd9f2D4B4Bdf8Fc970DFe8d9871c28"
	// GenesisAccount used for matchEth tx
	MockSmartContractCallSenderAccount = "0x7cefC13B6E2aedEeDFB7Cb6c32457240746BAEe5"
)

type DevNodeConfig struct {
	PrivKey     *ecdsa.PrivateKey
	VotingPower int64
	NodeID      string
}

type DevEnvironmentConfig struct {
	DevNodeSet []DevNodeConfig

	proposalIndex  int
	VotingStrategy map[VoteTurn]int
}

type node struct {
	key         string
	votingPower int64
	nodeID      string
}

type VoteTurn struct {
	Height   int
	Round    int
	VoteType int
}

type account struct {
	address string
	balance int64
}

const (
	// password is used to get keystore
	password = "KardiaChain"
)

var IsUsingNeoTestNet = true
var NeoSubmitTxUrl = "http://35.240.175.184:5000"
var NeoCheckTxUrl = "http://35.240.175.184:4000/api/main_net/v1/get_transaction/"
var TestnetNeoSubmitUrl = "http://35.185.187.119:5000"
var TestnetNeoCheckTxUrl = "https://neoscan-testnet.io/api/test_net/v1/get_transaction/"
var NeoReceiverAddress = "AaXPGsJhyRb55r8tREPWWNcaTHq4iiTFAH"
var initValue = int64(math.Pow10(15))

// GenesisAccounts are used to initialized accounts in genesis block
var GenesisAccounts = map[string]int64{
	// TODO(kiendn): These addresses are same of node address. Change to another set.
	"0xc1fe56E3F58D3244F606306611a5d10c8333f1f6": initValue,
	"0x7cefC13B6E2aedEeDFB7Cb6c32457240746BAEe5": initValue,
	"0xfF3dac4f04dDbD24dE5D6039F90596F0a8bb08fd": initValue,
	"0x071E8F5ddddd9f2D4B4Bdf8Fc970DFe8d9871c28": initValue,
	"0x94FD535AAB6C01302147Be7819D07817647f7B63": initValue,
	"0xa8073C95521a6Db54f4b5ca31a04773B093e9274": initValue,
	"0xe94517a4f6f45e80CbAaFfBb0b845F4c0FDD7547": initValue,
	"0xBA30505351c17F4c818d94a990eDeD95e166474b": initValue,
	"0x212a83C0D7Db5C526303f873D9CeaA32382b55D0": initValue,
	"0x8dB7cF1823fcfa6e9E2063F983b3B96A48EEd5a4": initValue,
	// TODO(namdoh): Re-enable after parsing node index fixed in main.go
	//"0x36BE7365e6037bD0FDa455DC4d197B07A2002547": 100000000,
}

var GenesisContractAddress = []string{
	"0x00000000000000000000000000000000736D6332",
	"0x00000000000000000000000000000000736D6331",
	"0x00000000000000000000000000000000736D6333",
	"0x00000000000000000000000000000000736D6339",
}

// RawByteCode used for creating simple counter contract
var RawByteCode = "608060405234801561001057600080fd5b50610108806100206000396000f3006080604052600436106049576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806324b8ba5f14604e5780636d4ce63c14607b575b600080fd5b348015605957600080fd5b506079600480360381019080803560ff16906020019092919050505060a9565b005b348015608657600080fd5b50608d60c6565b604051808260ff1660ff16815260200191505060405180910390f35b806000806101000a81548160ff021916908360ff16021790555050565b60008060009054906101000a900460ff169050905600a165627a7a7230582083f88bef40b78ed8ab5f620a7a1fb7953640a541335c5c352ff0877be0ecd0c60029"

// GenesisContract are used to initialize contract in genesis block
var GenesisContracts = map[string]string{
	//"0x00000000000000000000000000000000736d6331": "60806040526004361060485763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166324b8ba5f8114604d5780636d4ce63c146067575b600080fd5b348015605857600080fd5b50606560ff60043516608f565b005b348015607257600080fd5b50607960a5565b6040805160ff9092168252519081900360200190f35b6000805460ff191660ff92909216919091179055565b60005460ff16905600a165627a7a723058206cc1a54f543612d04d3f16b0bbb49e9ded9ccf6d47f7789fe3577260346ed44d0029",
	// Simple voting contract bytecode in genesis block, source code in kvm/smc/Ballot.sol
	"0x00000000000000000000000000000000736D6332": "608060405260043610610057576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063124474a71461005c578063609ff1bd146100a0578063b3f98adc146100d1575b600080fd5b34801561006857600080fd5b5061008a600480360381019080803560ff169060200190929190505050610101565b6040518082815260200191505060405180910390f35b3480156100ac57600080fd5b506100b5610138565b604051808260ff1660ff16815260200191505060405180910390f35b3480156100dd57600080fd5b506100ff600480360381019080803560ff16906020019092919050505061019e565b005b600060048260ff161015156101195760009050610133565b60018260ff1660048110151561012b57fe5b016000015490505b919050565b6000806000809150600090505b60048160ff161015610199578160018260ff1660048110151561016457fe5b0160000154111561018c5760018160ff1660048110151561018157fe5b016000015491508092505b8080600101915050610145565b505090565b60008060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002090508060000160009054906101000a900460ff1680610201575060048260ff1610155b1561020b5761026a565b60018160000160006101000a81548160ff021916908315150217905550818160000160016101000a81548160ff021916908360ff1602179055506001808360ff1660048110151561025857fe5b01600001600082825401925050819055505b50505600a165627a7a72305820c93a970449b32fe53b59e0ed7cfeda5d52acafd2d1bdd3f2f67093f076acf1c60029",
	// Counter contract bytecode in genesis block, source code in kvm/smc/SimpleCounter.sol
	"0x00000000000000000000000000000000736D6331": "6080604052600436106049576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806324b8ba5f14604e5780636d4ce63c14607b575b600080fd5b348015605957600080fd5b506079600480360381019080803560ff16906020019092919050505060a9565b005b348015608657600080fd5b50608d60c6565b604051808260ff1660ff16815260200191505060405180910390f35b806000806101000a81548160ff021916908360ff16021790555050565b60008060009054906101000a900460ff169050905600a165627a7a7230582083f88bef40b78ed8ab5f620a7a1fb7953640a541335c5c352ff0877be0ecd0c60029",
	// Exchange master contract bytecode in genesis block, source code in kvm.smc/Exchange.sol
	"0x00000000000000000000000000000000736D6333": "60806040526004361061008d5763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416630a0306b18114610092578063323a9243146100b95780633c3c9c23146100d357806344af18e8146100e8578063613d03af146101005780636e63987d1461011557806386dca3341461012d578063fa8513de14610145575b600080fd5b34801561009e57600080fd5b506100a761015a565b60408051918252519081900360200190f35b3480156100c557600080fd5b506100d1600435610179565b005b3480156100df57600080fd5b506100a7610194565b3480156100f457600080fd5b506100d160043561019a565b34801561010c57600080fd5b506100a76101b5565b34801561012157600080fd5b506100d16004356101bb565b34801561013957600080fd5b506100d16004356101c6565b34801561015157600080fd5b506100a76101d1565b600060015460005411156101715750600154610176565b506000545b90565b60015481111561018857600080fd5b60018054919091039055565b60005481565b6000548111156101a957600080fd5b60008054919091039055565b60015481565b600180549091019055565b600080549091019055565b6000805460015411156101e75750600054610176565b50600154905600a165627a7a723058203f7b9ba72392daf2bb6f8a91c0d4a8a3dcd58decc81ffc4fd90951f41cb9490c0029",
	// New exchange master contract bytecode in genesis block allows multiple recipients, source code in kvm.smc/NewExchange.sol
	"0x00000000000000000000000000000000736D6339": "60806040526004361061008e576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680632c72bd871461009357806342e11635146101105780634d78b88e146101ce5780637fb06000146102825780638e4a240414610306578063ab2cb4f914610383578063b41f6a7a1461040a578063f2b57a28146105d6575b600080fd5b34801561009f57600080fd5b506100fa600480360381019080803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919291929050505061072f565b6040518082815260200191505060405180910390f35b34801561011c57600080fd5b50610177600480360381019080803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290505050610880565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b838110156101ba57808201518184015260208101905061019f565b505050509050019250505060405180910390f35b3480156101da57600080fd5b506101f9600480360381019080803590602001909291905050506109ec565b6040518084815260200180602001838152602001828103825284818151815260200191508051906020019080838360005b8381101561024557808201518184015260208101905061022a565b50505050905090810190601f1680156102725780820380516001836020036101000a031916815260200191505b5094505050505060405180910390f35b34801561028e57600080fd5b506102e9600480360381019080803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290505050610ca0565b604051808381526020018281526020019250505060405180910390f35b34801561031257600080fd5b50610381600480360381019080803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091929192908035906020019092919080359060200190929190505050610d8a565b005b34801561038f57600080fd5b506103f460048036038101908080359060200190929190803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290505050610e26565b6040518082815260200191505060405180910390f35b34801561041657600080fd5b5061054d600480360381019080803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091929192908035906020019092919050505061133a565b6040518084815260200180602001838152602001828103825284818151815260200191508051906020019080838360005b8381101561059957808201518184015260208101905061057e565b50505050905090810190601f1680156105c65780820380516001836020036101000a031916815260200191505b5094505050505060405180910390f35b3480156105e257600080fd5b50610719600480360381019080803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290803590602001909291905050506118dc565b6040518082815260200191505060405180910390f35b6000606060008092506001846040518082805190602001908083835b602083101515610770578051825260208201915060208101905060208303925061074b565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390208054806020026020016040519081016040528092919081815260200182805480156107ed57602002820191906000526020600020905b8154815260200190600101908083116107d9575b50505050509150600090505b8151811015610876576000806000848481518110151561081557fe5b90602001906020020151815260200190815260200160002060050154141561086957600080838381518110151561084857fe5b90602001906020020151815260200190815260200160002060040154830192505b80806001019150506107f9565b8292505050919050565b60608060006001846040518082805190602001908083835b6020831015156108bd5780518252602082019150602081019050602083039250610898565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902080548060200260200160405190810160405280929190818152602001828054801561093a57602002820191906000526020600020905b815481526020019060010190808311610926575b50505050509150600a6040519080825280602002602001820160405280156109715781602001602082028038833980820191505090505b509250600090505b81518110156109e257600a8110156109d557600080838381518110151561099c57fe5b9060200190602002015181526020019081526020016000206004015483828151811015156109c657fe5b90602001906020020181815250505b8080600101915050610979565b8292505050919050565b600060606000806109fb612ab8565b6000808781526020019081526020016000206005015491506000821415610a4257600080819150602060405190810160405280600081525090809050945094509450610c97565b60008083815260200190815260200160002060e06040519081016040529081600082018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610af95780601f10610ace57610100808354040283529160200191610af9565b820191906000526020600020905b815481529060010190602001808311610adc57829003601f168201915b50505050508152602001600182018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610b9b5780601f10610b7057610100808354040283529160200191610b9b565b820191906000526020600020905b815481529060010190602001808311610b7e57829003601f168201915b50505050508152602001600282018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610c3d5780601f10610c1257610100808354040283529160200191610c3d565b820191906000526020600020905b815481529060010190602001808311610c2057829003601f168201915b50505050508152602001600382015481526020016004820154815260200160058201548152602001600682015481525050905060008160c001511415610c96578181604001518260800151819150945094509450610c97565b5b50509193909250565b6000806002836040518082805190602001908083835b602083101515610cdb5780518252602082019150602081019050602083039250610cb6565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600001546002846040518082805190602001908083835b602083101515610d4a5780518252602082019150602081019050602083039250610d25565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390206001015491509150915091565b6040805190810160405280838152602001828152506002846040518082805190602001908083835b602083101515610dd75780518252602082019150602081019050602083039250610db2565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390206000820151816000015560208201518160010155905050505050565b6000610e30612ab8565b600080600086815260200190815260200160002060e06040519081016040529081600082018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610ee95780601f10610ebe57610100808354040283529160200191610ee9565b820191906000526020600020905b815481529060010190602001808311610ecc57829003601f168201915b50505050508152602001600182018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610f8b5780601f10610f6057610100808354040283529160200191610f8b565b820191906000526020600020905b815481529060010190602001808311610f6e57829003601f168201915b50505050508152602001600282018054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561102d5780601f106110025761010080835404028352916020019161102d565b820191906000526020600020905b81548152906001019060200180831161101057829003601f168201915b505050505081526020016003820154815260200160048201548152602001600582015481526020016006820154815250509150836040516020018082805190602001908083835b6020831015156110995780518252602082019150602081019050602083039250611074565b6001836020036101000a0380198251168184511680821785525050505050509050019150506040516020818303038152906040526040518082805190602001908083835b60208310151561110257805182526020820191506020810190506020830392506110dd565b6001836020036101000a03801982511681845116808217855250505050505090500191505060405180910390206000191682600001516040516020018082805190602001908083835b602083101515611170578051825260208201915060208101905060208303925061114b565b6001836020036101000a0380198251168184511680821785525050505050509050019150506040516020818303038152906040526040518082805190602001908083835b6020831015156111d957805182526020820191506020810190506020830392506111b4565b6001836020036101000a03801982511681845116808217855250505050505090500191505060405180910390206000191614151561121a5760009250611332565b6000806000878152602001908152602001600020600601541415156112425760009250611332565b60016000808781526020019081526020016000206006018190555060008086815260200190815260200160002060050154905061132d85826000808981526020019081526020016000206000018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156113235780601f106112f857610100808354040283529160200191611323565b820191906000526020600020905b81548152906001019060200180831161130657829003601f168201915b5050505050611c28565b600192505b505092915050565b60006060600080600061134b612ab8565b6113578b8a8a8a611fd1565b92506000831415611388576000808191506020604051908101604052806000815250908090509550955095506118ce565b60008084815260200190815260200160002060000160405160200180828054600181600116156101000203166002900480156113fb5780601f106113d95761010080835404028352918201916113fb565b820191906000526020600020905b8154815290600101906020018083116113e7575b50509150506040516020818303038152906040526040518082805190602001908083835b602083101515611444578051825260208201915060208101905060208303925061141f565b6001836020036101000a0380198251168184511680821785525050505050509050019150506040518091039020600019168a6040516020018082805190602001908083835b6020831015156114ae5780518252602082019150602081019050602083039250611489565b6001836020036101000a0380198251168184511680821785525050505050509050019150506040516020818303038152906040526040518082805190602001908083835b60208310151561151757805182526020820191506020810190506020830392506114f2565b6001836020036101000a03801982511681845116808217855250505050505090500191505060405180910390206000191614801561156b575060008060008581526020019081526020016000206005015414155b15611643578260008085815260200190815260200160002060020160008086815260200190815260200160002060040154818054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156116315780601f1061160657610100808354040283529160200191611631565b820191906000526020600020905b81548152906001019060200180831161161457829003601f168201915b505050505091509550955095506118ce565b6000808481526020019081526020016000206005015491506000821415156118ac5760008083815260200190815260200160002060e06040519081016040529081600082018054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561171c5780601f106116f15761010080835404028352916020019161171c565b820191906000526020600020905b8154815290600101906020018083116116ff57829003601f168201915b50505050508152602001600182018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156117be5780601f10611793576101008083540402835291602001916117be565b820191906000526020600020905b8154815290600101906020018083116117a157829003601f168201915b50505050508152602001600282018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156118605780601f1061183557610100808354040283529160200191611860565b820191906000526020600020905b81548152906001019060200180831161184357829003601f168201915b50505050508152602001600382015481526020016004820154815260200160058201548152602001600682015481525050905081816040015182608001518191509550955095506118ce565b6000808191506020604051908101604052806000815250908090509550955095505b505050955095509592505050565b60006118e6612af6565b6000806118f1612ab8565b6118fa8a61269c565b9350600084602001511480611913575060008460000151145b156119215760009450611c1b565b6003600081546001019190508190555083600001518460200151870281151561194657fe5b0492506119538984612735565b915060e0604051908101604052808b81526020018981526020018881526020018781526020018481526020018381526020016000815250905080600080600354815260200190815260200160002060008201518160000190805190602001906119bd929190612b10565b5060208201518160010190805190602001906119da929190612b10565b5060408201518160020190805190602001906119f7929190612b10565b50606082015181600301556080820151816004015560a0820151816005015560c0820151816006015590505060018a6040518082805190602001908083835b602083101515611a5b5780518252602082019150602081019050602083039250611a36565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390206003549080600181540180825580915050906001820390600052602060002001600090919290919091505550600082141515611c1557600354600080848152602001908152602001600020600501819055506000808381526020019081526020016000206002016040518082805460018160011615610100020316600290048015611b505780601f10611b2e576101008083540402835291820191611b50565b820191906000526020600020905b815481529060010190602001808311611b3c575b50509150506040518091039020896040518082805190602001908083835b602083101515611b935780518252602082019150602081019050602083039250611b6e565b6001836020036101000a03801982511681845116808217855250505050505090500191505060405180910390207f8dc1d65f72533cd068186029d9193e6e49fca64e41f026c18a1317ac6bb0ee898460008087815260200190815260200160002060040154604051808381526020018281526020019250505060405180910390a35b60035494505b5050505095945050505050565b60606000806001846040518082805190602001908083835b602083101515611c655780518252602082019150602081019050602083039250611c40565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020805480602002602001604051908101604052809291908181526020018280548015611ce257602002820191906000526020600020905b815481526020019060010190808311611cce575b5050505050925082519150600090505b8251811015611d2b57858382815181101515611d0a57fe5b906020019060200201511415611d1e578091505b8080600101915050611cf2565b8251821015611ebf576001846040518082805190602001908083835b602083101515611d6c5780518252602082019150602081019050602083039250611d47565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390206001845103815481101515611db057fe5b90600052602060002001546001856040518082805190602001908083835b602083101515611df35780518252602082019150602081019050602083039250611dce565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902083815481101515611e3357fe5b9060005260206000205050506001846040518082805190602001908083835b602083101515611e775780518252602082019150602081019050602083039250611e52565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020805480919060019003611ebd9190612b90565b505b600160008088815260200190815260200160002060060154148015611ef95750600160008087815260200190815260200160002060060154145b15611fc95760008087815260200190815260200160002060008082016000611f219190612bbc565b600182016000611f319190612bbc565b600282016000611f419190612bbc565b6003820160009055600482016000905560058201600090556006820160009055505060008086815260200190815260200160002060008082016000611f869190612bbc565b600182016000611f969190612bbc565b600282016000611fa69190612bbc565b600382016000905560048201600090556005820160009055600682016000905550505b505050505050565b600060606000611fdf612ab8565b6001886040518082805190602001908083835b6020831015156120175780518252602082019150602081019050602083039250611ff2565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902080548060200260200160405190810160405280929190818152602001828054801561209457602002820191906000526020600020905b815481526020019060010190808311612080575b50505050509250600091505b825182101561268c5760008084848151811015156120ba57fe5b90602001906020020151815260200190815260200160002060e06040519081016040529081600082018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156121775780601f1061214c57610100808354040283529160200191612177565b820191906000526020600020905b81548152906001019060200180831161215a57829003601f168201915b50505050508152602001600182018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156122195780601f106121ee57610100808354040283529160200191612219565b820191906000526020600020905b8154815290600101906020018083116121fc57829003601f168201915b50505050508152602001600282018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156122bb5780601f10612290576101008083540402835291602001916122bb565b820191906000526020600020905b81548152906001019060200180831161229e57829003601f168201915b505050505081526020016003820154815260200160048201548152602001600582015481526020016006820154815250509050866040516020018082805190602001908083835b6020831015156123275780518252602082019150602081019050602083039250612302565b6001836020036101000a0380198251168184511680821785525050505050509050019150506040516020818303038152906040526040518082805190602001908083835b602083101515612390578051825260208201915060208101905060208303925061236b565b6001836020036101000a03801982511681845116808217855250505050505090500191505060405180910390206000191681602001516040516020018082805190602001908083835b6020831015156123fe57805182526020820191506020810190506020830392506123d9565b6001836020036101000a0380198251168184511680821785525050505050509050019150506040516020818303038152906040526040518082805190602001908083835b6020831015156124675780518252602082019150602081019050602083039250612442565b6001836020036101000a03801982511681845116808217855250505050505090500191505060405180910390206000191614801561264c5750856040516020018082805190602001908083835b6020831015156124d957805182526020820191506020810190506020830392506124b4565b6001836020036101000a0380198251168184511680821785525050505050509050019150506040516020818303038152906040526040518082805190602001908083835b602083101515612542578051825260208201915060208101905060208303925061251d565b6001836020036101000a03801982511681845116808217855250505050505090500191505060405180910390206000191681604001516040516020018082805190602001908083835b6020831015156125b0578051825260208201915060208101905060208303925061258b565b6001836020036101000a0380198251168184511680821785525050505050509050019150506040516020818303038152906040526040518082805190602001908083835b60208310151561261957805182526020820191506020810190506020830392506125f4565b6001836020036101000a038019825116818451168082178552505050505050905001915050604051809103902060001916145b801561265b5750848160600151145b1561267f57828281518110151561266e57fe5b906020019060200201519350612691565b81806001019250506120a0565b600093505b505050949350505050565b6126a4612af6565b6002826040518082805190602001908083835b6020831015156126dc57805182526020820191506020810190506020830392506126b7565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020604080519081016040529081600082015481526020016001820154815250509050919050565b600060606000612743612ab8565b6001866040518082805190602001908083835b60208310151561277b5780518252602082019150602081019050602083039250612756565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390208054806020026020016040519081016040528092919081815260200182805480156127f857602002820191906000526020600020905b8154815260200190600101908083116127e4575b50505050509250600091505b8251821015612aaa57600080848481518110151561281e57fe5b90602001906020020151815260200190815260200160002060e06040519081016040529081600082018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156128db5780601f106128b0576101008083540402835291602001916128db565b820191906000526020600020905b8154815290600101906020018083116128be57829003601f168201915b50505050508152602001600182018054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561297d5780601f106129525761010080835404028352916020019161297d565b820191906000526020600020905b81548152906001019060200180831161296057829003601f168201915b50505050508152602001600282018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015612a1f5780601f106129f457610100808354040283529160200191612a1f565b820191906000526020600020905b815481529060010190602001808311612a0257829003601f168201915b505050505081526020016003820154815260200160048201548152602001600582015481526020016006820154815250509050848160600151148015612a69575060008160a00151145b8015612a79575060008160c00151145b15612a9d578282815181101515612a8c57fe5b906020019060200201519350612aaf565b8180600101925050612804565b600093505b50505092915050565b60e060405190810160405280606081526020016060815260200160608152602001600081526020016000815260200160008152602001600081525090565b604080519081016040528060008152602001600081525090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10612b5157805160ff1916838001178555612b7f565b82800160010185558215612b7f579182015b82811115612b7e578251825591602001919060010190612b63565b5b509050612b8c9190612c04565b5090565b815481835581811115612bb757818360005260206000209182019101612bb69190612c04565b5b505050565b50805460018160011615610100020316600290046000825580601f10612be25750612c01565b601f016020900490600052602060002090810190612c009190612c04565b5b50565b612c2691905b80821115612c22576000816000905550600101612c0a565b5090565b905600a165627a7a72305820e867f86f93f232f65d5ca5618d0cea5847f4baf6529cec193670cd48efd5e4f50029",
	// Permission master contract bytecode in genesis block, source code in kvm/smc/Permission.sol
	"0x00000000000000000000000000000000736D6336": "60806040526004361061006d576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806302f0697b1461007257806331e51ad414610169578063430ae633146101f0578063813775a31461026d578063fddf283814610390575b600080fd5b34801561007e57600080fd5b50610153600480360381019080803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290803573ffffffffffffffffffffffffffffffffffffffff1690602001909291908035906020019092919080359060200190929190803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290505050610417565b6040518082815260200191505060405180910390f35b34801561017557600080fd5b506101da600480360381019080803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919291929080359060200190929190505050610588565b6040518082815260200191505060405180910390f35b3480156101fc57600080fd5b50610257600480360381019080803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091929192905050506106bd565b6040518082815260200191505060405180910390f35b34801561027957600080fd5b506102d4600480360381019080803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091929192905050506107f0565b604051808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200184815260200183815260200180602001828103825283818151815260200191508051906020019080838360005b83811015610352578082015181840152602081019050610337565b50505050905090810190601f16801561037f5780820380516001836020036101000a031916815260200191505b509550505050505060405180910390f35b34801561039c57600080fd5b50610401600480360381019080803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919291929080359060200190929190505050610ba1565b6040518082815260200191505060405180910390f35b60006001151561042633610dc2565b151514151561043457600080fd5b60a0604051908101604052808673ffffffffffffffffffffffffffffffffffffffff168152602001848152602001858152602001600115158152602001838152506000876040518082805190602001908083835b6020831015156104ad5780518252602082019150602081019050602083039250610488565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060008201518160000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550602082015181600101556040820151816002015560608201518160030160006101000a81548160ff0219169083151502179055506080820151816004019080519060200190610577929190612013565b509050506001905095945050505050565b60006105948383610e60565b156105a257600190506106b7565b600015156000846040518082805190602001908083835b6020831015156105de57805182526020820191506020810190506020830392506105b9565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060030160009054906101000a900460ff161515141561063357600090506106b7565b816000846040518082805190602001908083835b60208310151561066c5780518252602082019150602081019050602083039250610647565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390206002015414156106b257600190506106b7565b600090505b92915050565b60006106c882610e93565b156106d657600190506107eb565b600015156000836040518082805190602001908083835b60208310151561071257805182526020820191506020810190506020830392506106ed565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060030160009054906101000a900460ff161515141561076757600090506107eb565b600080836040518082805190602001908083835b6020831015156107a0578051825260208201915060208101905060208303925061077b565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390206001015414156107e657600090506107eb565b600190505b919050565b60008060006060600061080286610ebe565b9050600a811015610865576108156118a0565b8181518110151561082257fe5b9060200190602002015160646001610838611c9d565b8481518110151561084557fe5b906020019060200201518292508191508090509450945094509450610b99565b600015156000876040518082805190602001908083835b6020831015156108a1578051825260208201915060208101905060208303925061087c565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060030160009054906101000a900460ff161515141561091957600080600082925081915080905060206040519081016040528060008152509450945094509450610b99565b6000866040518082805190602001908083835b602083101515610951578051825260208201915060208101905060208303925061092c565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff166000876040518082805190602001908083835b6020831015156109e057805182526020820191506020810190506020830392506109bb565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600101546000886040518082805190602001908083835b602083101515610a4f5780518252602082019150602081019050602083039250610a2a565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600201546000896040518082805190602001908083835b602083101515610abe5780518252602082019150602081019050602083039250610a99565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600401808054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610b895780601f10610b5e57610100808354040283529160200191610b89565b820191906000526020600020905b815481529060010190602001808311610b6c57829003601f168201915b5050505050905094509450945094505b509193509193565b600060011515610bb033610dc2565b1515141515610bbe57600080fd5b60011515610bcc8484610e60565b15151415610bdd5760009050610dbc565b600015156000846040518082805190602001908083835b602083101515610c195780518252602082019150602081019050602083039250610bf4565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060030160009054906101000a900460ff1615151415610c6e5760009050610dbc565b816000846040518082805190602001908083835b602083101515610ca75780518252602082019150602081019050602083039250610c82565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060020154141515610cee5760009050610dbc565b6000836040518082805190602001908083835b602083101515610d265780518252602082019150602081019050602083039250610d01565b6001836020036101000a0380198251168184511680821785525050505050509050019150509081526020016040518091039020600080820160006101000a81549073ffffffffffffffffffffffffffffffffffffffff0219169055600182016000905560028201600090556003820160006101000a81549060ff0219169055600482016000610db59190612093565b5050600190505b92915050565b600060606000610dd06118a0565b9150600082511415610de55760009250610e59565b600090505b8151811015610e54578373ffffffffffffffffffffffffffffffffffffffff168282815181101515610e1857fe5b9060200190602002015173ffffffffffffffffffffffffffffffffffffffff161415610e475760019250610e59565b8080600101915050610dea565b600092505b5050919050565b6000600b610e6d84610ebe565b108015610e7a5750600182145b15610e885760019050610e8d565b600090505b92915050565b600080610e9f83610ebe565b9050600a811015610eb35760019150610eb8565b600091505b50919050565b600060606000600a604051908082528060200260200182016040528015610ef957816020015b6060815260200190600190039081610ee45790505b50915060a060405190810160405280608081526020017f376138366532623736323863373666636165373661386233373032356362613681526020017f393861323839613434313032633563303231353934623563396663653333303781526020017f326565376566393932663565303138646334346239386661313166656335333881526020017f3234643739303135373437653861633437346634656531356237666265383630815250826000815181101515610fb457fe5b9060200190602002018190525060a060405190810160405280608081526020017f363630383839653339623337616465353866373839393333393534313233653581526020017f366436343938393836613063643963613633643232336538363664353532316181526020017f616564633965353239386532663438323861356339306634633538666232346581526020017f313936313361343632636130323130646439363238323137393466363330663081525082600181518110151561107957fe5b9060200190602002018190525060a060405190810160405280608081526020017f326536316635373230316563383034663964353239386334363635383434666481526020017f303737613235313663643333656363656134386637626466393364653531383281526020017f646134663537646337623464383837306535653239316331373963303566663081526020017f343130303731386234393138346636346137633064343063633636333433646181525082600281518110151561113e57fe5b9060200190602002018190525060a060405190810160405280608081526020017f666334316137316437613734643836363564626363306634386339613630316581526020017f333062373134656435303634373636396566353263303366373132336632616581526020017f303738646361613336333839653236333665313035356635663630666466333881526020017f643839613232366565383432333466303036623333336361643264326263656581525082600381518110151561120357fe5b9060200190602002018190525060a060405190810160405280608081526020017f656266343666616361373534666339303731366436363565366336666562323081526020017f366361343337633965356631363639306536393035313362333032393335303581526020017f336139643732326238386432616230623937326634363434386633613533333781526020017f38626635636665303162383337336166326535343139376231373631376531638152508260048151811015156112c857fe5b9060200190602002018190525060a060405190810160405280608081526020017f383063346662663635313232643831376433383038616663623638336663363681526020017f643966396531396234373665613065653366373537646361356364313833313681526020017f656362383939396266656134653961356163633939363835303463623931393981526020017f393761356331616236323363356335333363623636323239313134396230613381525082600581518110151561138d57fe5b9060200190602002018190525060a060405190810160405280608081526020017f356437656438313331393136623130656135343561353539616265343634333081526020017f373130396133643632646462653139633336383938386262646231646432333381526020017f306236663362626234373964306264643739656633363064376439313735303081526020017f386439306637643531313232393639323130373933653861373532636563643681525082600681518110151561145257fe5b9060200190602002018190525060a060405190810160405280608081526020017f376563643465613162663465666133346461633431613136643763636431346581526020017f323364333939336464336630613534643732326565373664313730373138616481526020017f626137663234366330383262616461393232633837356666616161343631386581526020017f333037623638653434633238343764346634653362373637383834633032623781525082600781518110151561151757fe5b9060200190602002018190525060a060405190810160405280608081526020017f343835376637393265663737396335313166366437363433663039393134303981526020017f663737653431313234636564313433383532313735333536343133313566356481526020017f633939323765373330316666643761666337616538303235363633653137663581526020017f39333330366164663764336666616337633661613632356332353064653064358152508260088151811015156115dc57fe5b9060200190602002018190525060a060405190810160405280608081526020017f616436376332353032666332373233663264636632356131343037343433383281526020017f656233653465353064376534646439313063343233663761613466653066626281526020017f636332323037643232656636656466343639646436666265613733656661386481526020017f38376234623837366130643665333836633465303062366135316332613366388152508260098151811015156116a157fe5b90602001906020020181905250600090505b600a8110156118945781818151811015156116ca57fe5b906020019060200201516040516020018082805190602001908083835b60208310151561170c57805182526020820191506020810190506020830392506116e7565b6001836020036101000a0380198251168184511680821785525050505050509050019150506040516020818303038152906040526040518082805190602001908083835b6020831015156117755780518252602082019150602081019050602083039250611750565b6001836020036101000a038019825116818451168082178552505050505050905001915050604051809103902060001916846040516020018082805190602001908083835b6020831015156117df57805182526020820191506020810190506020830392506117ba565b6001836020036101000a0380198251168184511680821785525050505050509050019150506040516020818303038152906040526040518082805190602001908083835b6020831015156118485780518252602082019150602081019050602083039250611823565b6001836020036101000a038019825116818451168082178552505050505050905001915050604051809103902060001916141561188757809250611899565b80806001019150506116b3565b600a92505b5050919050565b606080600a6040519080825280602002602001820160405280156118d35781602001602082028038833980820191505090505b50905073c1fe56e3f58d3244f606306611a5d10c8333f1f68160008151811015156118fa57fe5b9060200190602002019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff1681525050737cefc13b6e2aedeedfb7cb6c32457240746baee581600181518110151561195a57fe5b9060200190602002019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff168152505073ff3dac4f04ddbd24de5d6039f90596f0a8bb08fd8160028151811015156119ba57fe5b9060200190602002019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff168152505073071e8f5ddddd9f2d4b4bdf8fc970dfe8d9871c28816003815181101515611a1a57fe5b9060200190602002019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250507394fd535aab6c01302147be7819d07817647f7b63816004815181101515611a7a57fe5b9060200190602002019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff168152505073a8073c95521a6db54f4b5ca31a04773b093e9274816005815181101515611ada57fe5b9060200190602002019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff168152505073e94517a4f6f45e80cbaaffbb0b845f4c0fdd7547816006815181101515611b3a57fe5b9060200190602002019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff168152505073ba30505351c17f4c818d94a990eded95e166474b816007815181101515611b9a57fe5b9060200190602002019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff168152505073212a83c0d7db5c526303f873d9ceaa32382b55d0816008815181101515611bfa57fe5b9060200190602002019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff1681525050738db7cf1823fcfa6e9e2063f983b3b96a48eed5a4816009815181101515611c5a57fe5b9060200190602002019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250508091505090565b606080600a604051908082528060200260200182016040528015611cd557816020015b6060815260200190600190039081611cc05790505b5090506040805190810160405280600981526020017f5b3a3a5d3a333030300000000000000000000000000000000000000000000000815250816000815181101515611d1d57fe5b906020019060200201819052506040805190810160405280600981526020017f5b3a3a5d3a333030310000000000000000000000000000000000000000000000815250816001815181101515611d6f57fe5b906020019060200201819052506040805190810160405280600981526020017f5b3a3a5d3a333030320000000000000000000000000000000000000000000000815250816002815181101515611dc157fe5b906020019060200201819052506040805190810160405280600981526020017f5b3a3a5d3a333030330000000000000000000000000000000000000000000000815250816003815181101515611e1357fe5b906020019060200201819052506040805190810160405280600981526020017f5b3a3a5d3a333030340000000000000000000000000000000000000000000000815250816004815181101515611e6557fe5b906020019060200201819052506040805190810160405280600981526020017f5b3a3a5d3a333030350000000000000000000000000000000000000000000000815250816005815181101515611eb757fe5b906020019060200201819052506040805190810160405280600981526020017f5b3a3a5d3a333030360000000000000000000000000000000000000000000000815250816006815181101515611f0957fe5b906020019060200201819052506040805190810160405280600981526020017f5b3a3a5d3a333030370000000000000000000000000000000000000000000000815250816007815181101515611f5b57fe5b906020019060200201819052506040805190810160405280600981526020017f5b3a3a5d3a333030380000000000000000000000000000000000000000000000815250816008815181101515611fad57fe5b906020019060200201819052506040805190810160405280600981526020017f5b3a3a5d3a333030390000000000000000000000000000000000000000000000815250816009815181101515611fff57fe5b906020019060200201819052508091505090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061205457805160ff1916838001178555612082565b82800160010185558215612082579182015b82811115612081578251825591602001919060010190612066565b5b50905061208f91906120db565b5090565b50805460018160011615610100020316600290046000825580601f106120b957506120d8565b601f0160209004906000526020600020908101906120d791906120db565b5b50565b6120fd91905b808211156120f95760008160009055506001016120e1565b5090565b905600a165627a7a72305820fb0c7327a0940b99a7f0124d1b2903d55c6b3dcb515f219d0800099b1b61b87c0029",
}

// abi for contract in genesis block
var GenesisContractAbis = map[string]string{
	// This is abi for counter contract
	"0x00000000000000000000000000000000736d6331": `[
		{"constant": false,"inputs": [{"name": "x","type": "uint8"}],"name": "set","outputs": [],"payable": false,"stateMutability": "nonpayable","type": "function"},
		{"constant": true,"inputs": [],"name": "get","outputs": [{"name": "","type": "uint8"}],"payable": false,"stateMutability": "view","type": "function"}
	]`,
	// This is abi for simple voting contract
	"0x00000000000000000000000000000000736d6332": `[
		{"constant": true,"inputs": [{"name": "toProposal","type": "uint8"}],"name": "getVote","outputs": [{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},
		{"constant": true,"inputs": [],"name": "winningProposal","outputs": [{"name": "_winningProposal","type": "uint8"}],"payable": false,"stateMutability": "view","type": "function"},
		{"constant": false,"inputs": [{"name": "toProposal","type": "uint8"}],"name": "vote","outputs": [],"payable": false,"stateMutability": "nonpayable","type": "function"}
	]`,
	// This is abi for master exchange contract
	"0x00000000000000000000000000000000736d6333": `[
		{"constant":true,"inputs":[],"name":"getNeoToSend","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},
		{"constant":false,"inputs":[{"name":"neo","type":"uint256"}],"name":"removeNeo","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},
		{"constant":true,"inputs":[],"name":"totalEth","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},
		{"constant":false,"inputs":[{"name":"eth","type":"uint256"}],"name":"removeEth","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},
		{"constant":true,"inputs":[],"name":"totalNeo","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},
		{"constant":false,"inputs":[{"name":"neo","type":"uint256"}],"name":"matchNeo","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},
		{"constant":false,"inputs":[{"name":"eth","type":"uint256"}],"name":"matchEth","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},
		{"constant":true,"inputs":[],"name":"getEthToSend","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"}
	]`,
	"0x00000000000000000000000000000000736D6339": `[
		{"constant": true,"inputs": [{"name": "pair","type": "string"}],"name": "getAvailableAmountByPair",
	"outputs": [{"name": "amount","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},
		{"constant": true,"inputs": [{"name": "pair","type": "string"}],"name": "getMatchableAmount","outputs": [{"name": "amounts",
	"type": "uint256[]"}],"payable": false,"stateMutability": "view","type": "function"},
		{"constant": true,"inputs":[{"name": "requestID","type": "uint256"}],"name": "getUncompletedMatchingRequest",
	"outputs": [{"name": "matchedRequestID","type": "uint256"},{"name": "destAddress","type": "string"},
	{"name": "sendAmount","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},
		{"constant": true,"inputs": [{"name": "pair","type": "string"}],"name": "getRatePublic","outputs": [{"name": "sale",
	"type": "uint256"},{"name": "receive","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},
		{"constant": false,"inputs": [{"name": "pair","type": "string"},{"name": "sale_amount","type": "uint256"},
	{"name": "receiveAmount","type": "uint256"}],"name": "addRate","outputs": [],"payable": false,
	"stateMutability": "nonpayable","type": "function"},
		{"constant": false,"inputs": [{"name": "requestID","type": "uint256"},{"name": "pair","type": "string"}],
	"name": "completeRequest","outputs": [{"name": "success","type": "uint256"}],"payable": false,
	"stateMutability": "nonpayable","type": "function"},
		{"constant": true,"inputs": [{"name": "sourcePair","type": "string"},{"name": "interestedPair","type": "string"},
	{"name": "fromAddress","type": "string"},{"name": "toAddress","type": "string"},{"name": "amount","type": "uint256"}],
	"name": "getMatchingRequestInfo","outputs": [{"name": "matchedRequestID","type": "uint256"},{"name": "destAddress",
	"type": "string"},{"name": "sendAmount","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},
		{"constant": false,"inputs": [{"name": "srcPair","type": "string"},{"name": "destPair","type": "string"},{"name": "srcAddress",
	"type": "string"},{"name": "destAddress","type": "string"},{"name": "amount","type": "uint256"}],"name": "matchRequest",
	"outputs": [{"name": "","type": "uint256"}],"payable": false,"stateMutability": "nonpayable","type": "function"},
		{"anonymous": false,"inputs": [{"indexed": true,"name": "pair","type": "string"},{"indexed": true,"name": "addr",
	"type": "string"},{"indexed": false,"name": "matchRequestId","type": "uint256"},{"indexed": false,"name": "_value",
	"type": "uint256"}],"name": "Release","type": "event"}]`,
	"0x00000000000000000000000000000000736D6336": `[
		{"constant": true,"inputs": [{"name": "_pubkey","type": "string"},{"name": "_nodeType","type": "uint256"}],
	"name": "isValidNode","outputs": [{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view",
	"type": "function"},
		{"constant": true,"inputs": [{"name": "_pubkey","type": "string"}],"name": "isValidator","outputs": [{"name": "",
	"type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},
		{"constant": true,"inputs": [{"name": "_pubkey","type": "string"}],"name": "getNodeInfo","outputs": [{"name": "addr",
	"type": "address"},{"name": "votingPower","type": "uint256"},{"name": "nodeType","type": "uint256"}, {"name": "listenAddress","type": "string"}],"payable": false,"stateMutability": "view","type": "function"},
		{"constant": false,"inputs": [{"name": "_pubkey","type": "string"},{"name": "_addr","type": "address"},{"name": "_nodeType",
	"type": "uint256"},{"name": "_votingPower","type": "uint256"},{"name": "listenAddress","type": "string"}],"name": "addNode","outputs": [{"name": "","type": "uint256"}],
	"payable": false,"stateMutability": "nonpayable","type": "function"},
		{"constant": false,"inputs": [{"name": "_pubkey","type": "string"},{"name": "_nodeType","type": "uint256"}],
	"name": "removeNode","outputs": [{"name": "","type": "uint256"}],"payable": false,"stateMutability": "nonpayable","type": "function"
	}]`,
}

//  GenesisAddrKeys maps genesis account addresses to private keys.
var GenesisAddrKeys = map[string]string{
	// TODO(kiendn): These addresses are same of node address. Change to another set.
	"0xc1fe56E3F58D3244F606306611a5d10c8333f1f6": "8843ebcb1021b00ae9a644db6617f9c6d870e5fd53624cefe374c1d2d710fd06",
	"0x7cefC13B6E2aedEeDFB7Cb6c32457240746BAEe5": "77cfc693f7861a6e1ea817c593c04fbc9b63d4d3146c5753c008cfc67cffca79",
	"0xfF3dac4f04dDbD24dE5D6039F90596F0a8bb08fd": "98de1df1e242afb02bd5dc01fbcacddcc9a4d41df95a66f629139560ca6e4dbb",
	"0x071E8F5ddddd9f2D4B4Bdf8Fc970DFe8d9871c28": "32f5c0aef7f9172044a472478421c63fd8492640ff2d0eaab9562389db3a8efe",
	"0x94FD535AAB6C01302147Be7819D07817647f7B63": "68b53a92d846baafdc782cb9cad65d77020c8d747eca7b621370b52b18c91f9a",
	"0xa8073C95521a6Db54f4b5ca31a04773B093e9274": "049de018e08c3bcd59c1a21f0cf7de8f17fe51f8ce7d9c2120d17b1f0251b265",
	"0xe94517a4f6f45e80CbAaFfBb0b845F4c0FDD7547": "9fdd56a3c2a536dc8f981d935f0f3f2ea04e125547fdfffa37e157ce86ff1007",
	"0xBA30505351c17F4c818d94a990eDeD95e166474b": "ae1a52546294bed6e734185775dbc84009de00bdf51b709471e2415c31ceeed7",
	"0x212a83C0D7Db5C526303f873D9CeaA32382b55D0": "b34bd81838a4a335fb3403d0bf616eca1eb9a4b4716c7dda7c617503cfeaab67",
	"0x8dB7cF1823fcfa6e9E2063F983b3B96A48EEd5a4": "0cf7ae0332a891044659ace49a0732fa07c2872b4aef479945501f385a23e689",
	// TODO(namdoh): Re-enable after parsing node index fixed in main.go
	//"e049a09c992c882bc2deb780323a247c6ee0951f8b4c5c1dd0fc2fc22ce6493d": "0x36BE7365e6037bD0FDa455DC4d197B07A2002547",
}

var nodes = []node{
	{"8843ebcb1021b00ae9a644db6617f9c6d870e5fd53624cefe374c1d2d710fd06", 100, "enode://7a86e2b7628c76fcae76a8b37025cba698a289a44102c5c021594b5c9fce33072ee7ef992f5e018dc44b98fa11fec53824d79015747e8ac474f4ee15b7fbe860@[::]:3000"},
	{"77cfc693f7861a6e1ea817c593c04fbc9b63d4d3146c5753c008cfc67cffca79", 100, "enode://660889e39b37ade58f789933954123e56d6498986a0cd9ca63d223e866d5521aaedc9e5298e2f4828a5c90f4c58fb24e19613a462ca0210dd962821794f630f0@[::]:3001"},
	{"98de1df1e242afb02bd5dc01fbcacddcc9a4d41df95a66f629139560ca6e4dbb", 100, "enode://2e61f57201ec804f9d5298c4665844fd077a2516cd33eccea48f7bdf93de5182da4f57dc7b4d8870e5e291c179c05ff04100718b49184f64a7c0d40cc66343da@[::]:3002"},
	{"32f5c0aef7f9172044a472478421c63fd8492640ff2d0eaab9562389db3a8efe", 100, "enode://fc41a71d7a74d8665dbcc0f48c9a601e30b714ed50647669ef52c03f7123f2ae078dcaa36389e2636e1055f5f60fdf38d89a226ee84234f006b333cad2d2bcee@[::]:3003"},
	{"68b53a92d846baafdc782cb9cad65d77020c8d747eca7b621370b52b18c91f9a", 100, "enode://ebf46faca754fc90716d665e6c6feb206ca437c9e5f16690e690513b302935053a9d722b88d2ab0b972f46448f3a53378bf5cfe01b8373af2e54197b17617e1c@[::]:3004"},
	{"049de018e08c3bcd59c1a21f0cf7de8f17fe51f8ce7d9c2120d17b1f0251b265", 100, "enode://80c4fbf65122d817d3808afcb683fc66d9f9e19b476ea0ee3f757dca5cd18316ecb8999bfea4e9a5acc9968504cb919997a5c1ab623c5c533cb662291149b0a3@[::]:3005"},
	{"9fdd56a3c2a536dc8f981d935f0f3f2ea04e125547fdfffa37e157ce86ff1007", 100, "enode://5d7ed8131916b10ea545a559abe464307109a3d62ddbe19c368988bbdb1dd2330b6f3bbb479d0bdd79ef360d7d9175008d90f7d51122969210793e8a752cecd6@[::]:3006"},
	{"ae1a52546294bed6e734185775dbc84009de00bdf51b709471e2415c31ceeed7", 100, "enode://7ecd4ea1bf4efa34dac41a16d7ccd14e23d3993dd3f0a54d722ee76d170718adba7f246c082bada922c875ffaaa4618e307b68e44c2847d4f4e3b767884c02b7@[::]:3007"},
	{"b34bd81838a4a335fb3403d0bf616eca1eb9a4b4716c7dda7c617503cfeaab67", 100, "enode://4857f792ef779c511f6d7643f0991409f77e41124ced14385217535641315f5dc9927e7301ffd7afc7ae8025663e17f593306adf7d3ffac7c6aa625c250de0d5@[::]:3008"},
	{"0cf7ae0332a891044659ace49a0732fa07c2872b4aef479945501f385a23e689", 100, "enode://ad67c2502fc2723f2dcf25a140744382eb3e4e50d7e4dd910c423f7aa4fe0fbbcc2207d22ef6edf469dd6fbea73efa8d87b4b876a0d6e386c4e00b6a51c2a3f8@[::]:3009"},
	// TODO(namdoh): Re-enable after parsing node index fixed in main.go
	//{"e049a09c992c882bc2deb780323a247c6ee0951f8b4c5c1dd0fc2fc22ce6493d", 100, ""},
}

func CreateDevEnvironmentConfig() *DevEnvironmentConfig {
	var devEnv DevEnvironmentConfig
	devEnv.proposalIndex = 0 // Default to 0-th node as the proposer.
	devEnv.DevNodeSet = make([]DevNodeConfig, len(nodes))
	for i, n := range nodes {
		pkByte, err := hex.DecodeString(n.key)
		if err != nil {
			continue
		}
		privKey, _ := crypto.ToECDSA(pkByte)
		devEnv.DevNodeSet[i].PrivKey = privKey
		devEnv.DevNodeSet[i].VotingPower = n.votingPower
		devEnv.DevNodeSet[i].NodeID = n.nodeID
	}

	return &devEnv
}

func (devEnv *DevEnvironmentConfig) SetVotingStrategy(votingStrategy string) {
	if strings.HasSuffix(votingStrategy, "csv") {
		devEnv.VotingStrategy = map[VoteTurn]int{}
		csvFile, _ := os.Open(votingStrategy)
		reader := csv.NewReader(bufio.NewReader(csvFile))

		for {
			line, error := reader.Read()
			if error == io.EOF {
				break
			} else if error != nil {
				log.Error("error", error)
			}
			var height, _ = strconv.Atoi(line[0])
			var round, _ = strconv.Atoi(line[1])
			var voteType, _ = strconv.Atoi(line[2])
			var result, _ = strconv.Atoi(line[3])

			var _, ok = devEnv.GetScriptedVote(height, round, voteType)
			if ok {
				log.Error(fmt.Sprintf("VoteTurn already exists with height = %v, round = %v, voteType = %v", height, round, voteType))
			} else {
				devEnv.VotingStrategy[VoteTurn{height, round, voteType}] = result
			}
		}
	}
}

func (devEnv *DevEnvironmentConfig) GetScriptedVote(height int, round int, voteType int) (int, bool) {
	if val, ok := devEnv.VotingStrategy[VoteTurn{height, round, voteType}]; ok {
		return val, ok
	}
	return 0, false
}

func (devEnv *DevEnvironmentConfig) SetProposerIndex(index int) {
	if index < 0 || index >= devEnv.GetNodeSize() {
		log.Error(fmt.Sprintf("Proposer index must be within %v and %v", 0, devEnv.GetNodeSize()))
	}
	devEnv.proposalIndex = index
}

func (devEnv *DevEnvironmentConfig) GetDevNodeConfig(index int) *DevNodeConfig {
	return &devEnv.DevNodeSet[index]
}

func (devEnv *DevEnvironmentConfig) GetNodeSize() int {
	return len(devEnv.DevNodeSet)
}

// GetValidatorSetByIndex takes an array of indexes of validators and returns an array of validators with the order respectively to index of input
func (devEnv *DevEnvironmentConfig) GetValidatorSetByIndex(valIndexes []int) *types.ValidatorSet {
	if len(valIndexes) > devEnv.GetNodeSize() {
		log.Error(fmt.Sprintf("Number of validators must be within %v and %v", 1, devEnv.GetNodeSize()))
	}
	validators := make([]*types.Validator, len(valIndexes))
	for i := 0; i < len(valIndexes); i++ {
		if valIndexes[i] < 0 || valIndexes[i] >= devEnv.GetNodeSize() {
			log.Error(fmt.Sprintf("Value of validator must be within %v and %v", 1, devEnv.GetNodeSize()))
		}
		node := devEnv.DevNodeSet[valIndexes[i]]
		validators[i] = types.NewValidator(node.PrivKey.PublicKey, node.VotingPower)
	}

	validatorSet := types.NewValidatorSet(validators)
	validatorSet.TurnOnKeepSameProposer()
	validatorSet.SetProposer(validators[devEnv.proposalIndex])
	return validatorSet
}

func GetContractAddressAt(index int) common.Address {
	if index >= len(GenesisContractAddress) {
		return common.Address{}
	}
	return common.HexToAddress(GenesisContractAddress[index])
}

func GetContractAbiByAddress(address string) string {
	// log.Info("Getting abi for address",  "address", address)
	for add, abi := range GenesisContractAbis {
		if strings.EqualFold(add, address) {
			return abi
		}
	}
	panic("abi not found")
}
func (devEnv *DevEnvironmentConfig) GetRawBytecode() string {
	return RawByteCode
}
